<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script
			  src="https://code.jquery.com/jquery-3.4.1.min.js"
			  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			  crossorigin="anonymous">
    </script>
<script src = "https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js"></script>
<style>
      /************************************ NAVBAR ************************************/
      body,html{
                margin: 0;
                padding: 0;
    
            }
            .header{
                width:186px;
                height:100%;
                background-color:dodgerblue;
                color: white; /* Black text color */
                display: inline-block; /* Make the links appear below each other */
                padding: 12px; /* Add some padding */
                text-decoration: none; /* Remove underline from links */
                position: fixed;
            }
            .titleBar{
                padding: 3px;
                float: left;
                margin-left: 2%;
                margin-top: 190px;
                font-family: spongeBob;
                color: #ffff;
            }
            span{
                color: #ffffff;
            }
            ul{
                width: auto;
                float: right;
                margin-top: 8px;
            }
            li{
                display: inline-block;
                padding: 15px 20px;
                font-family: spongeBob;
                color: #ffff;
            }
            a{
                text-align:center;
                color: #ffff;
                text-decoration: none;
                font-family: spongeBob;
                font-size: 25px;
            }
            a:hover{
                color: #F0C330;
                transition: 0.5s;
                cursor: pointer;
            }
            img{
                width:150px;
                margin-left: 22px;
                position: absolute;
                display: block;
            }
            @font-face{
                font-family: spongeBob;
                src: url("Some Time Later.otf");
            }
            /***********************************************************************************/

</style>
</head>
<body>
       <!------------------------ NAVBAR -------------------------->
       <div class="header">
            <h1 class="titleBar">KRAB<span> KORPORATION</span></h1>
                <nav>
                    <img src="krustykrabLogo.png">
                    <ul>
                        <li><a href="index3.html">CHARTS</a></li>
                        <li><a href="dashboard.html">TABLES</a></li>
                        <li><a href="login2.html">Log Out</a></li>
                            <!-- <a class="dropdown">PROFILE
                            <div class="dropdown-content"> -->
                                <!-- <p>Account</p>> -->
                            <!-- </div> -->
                    </ul>
                </nav>
            </header>
    </div>
    <div style="margin-left: 250px; margin-top: -22px;">
        <h1 style="font-family: spongeBob;">Upload your file!</h1>
        <input type="file" id="selectFiles" value="Import" /><br /><br />
        <button id="import">Import</button>
        <br>
        <div style = "width: 40%">
            <canvas id = "chart" width = "150px" height ="150px"></canvas>
        </div>
        <div style = "width: 40%">
            <canvas id = "chart2" width = "150px" height ="150px"></canvas>
        </div>
        <div style = "width: 40%">
                <canvas id = "chart3" width = "150px" height ="150px"></canvas>
        </div>
        
        <script>
        
        $(document).ready(function() {
                
                document.getElementById("selectFiles").innerHTML = "No File selected";
                
                //GETS THE FILENAME OF THE FILE UPLOADED
                document.getElementById('selectFiles').onchange = uploadOnChange;
                
                var filename = null;
                var arrayName = null;                
    
                function uploadOnChange() {
                    filename = this.value;
                    var lastIndex = filename.lastIndexOf("\\");
                    if (lastIndex >= 0) {
                        filename = filename.substring(lastIndex + 1);
                    }
                }   
                
                //SHOWS THE FILE ON THE IMPORT TEXTFIELD
                document.getElementById('import').onclick = function() {
                    var files = document.getElementById('selectFiles').files;
    
                    //ALERT THE FILENAME
                    alert(filename);
    
                    //ERROR CHECKING FOR FILE EXTENSION
                    var ext = filename.substring(filename.lastIndexOf('.') + 1);                
                    if (ext != "json"){
                        alert("Please enter a .json file only");
                    }
                    else{
                        alert("Your file is loading now!");
                    }
                
    
           
            
         async function readyy(){ // main function medyo wrong
                var burger_sales_name = [];
                var burger_sales_numbers = [];
                var species_sales_name = [];
                var species_sales_numbers = [];
                var everything_burger_names = [];
                var everything_species_names = [];
                var everything_species_numbers = [];
                var x = [];
                var j = [];
                var z = [];
                var k = [];
                var h = [];
                var s = [];
                var t = [];
                var y;
                
                $.getJSON(filename, function(data){
                    alert("hloo");
                $.each(data.burger_sales, function(key,value)
                {
                    //console.log(key, value);
                   
                    burger_sales_name.push(key);
                    burger_sales_numbers.push(value);
                })
                $.each(data.species_sales, function(key, value)
                {
                    //console.log(key,value);
                    species_sales_name.push(key);
                    species_sales_numbers.push(value);
                })
                $.each(data.burger_by_species, function(key, value) /* Traverses Burger_by_species or Object 
                                                                    {"Krusty Combo" : Object {"leatherback" : 518, "salmon":198}", "Krabby Pattie" */
                {
                    //console.log("Hi");
                    //console.log(key); // TITLE
                    //console.log(value); // should be Object {"leatherback" : 518, "salmon":198}
                    var items = [key,value]
                    everything_burger_names = key;     
                    y = value; //Getting the Nested JSON Object into a variable
                    $.each(y, function(key, value){
                    //    console.log("Hi2");
                      //  console.log(key,value + " tangina");
                        everything_species_names.push(key);
                        everything_species_numbers.push(value);
                    })
                
                })
    
                $.each(data.burger_by_species, function(key, value) /* Traverses Burger_by_species or Object 
                                                                    {"Krusty Combo" : Object {"leatherback" : 518, "salmon":198}", "Krabby Pattie" */
                {
                    //console.log("Hi");
                    //console.log(key); // TITLE
                    //console.log(value); // should be Object {"leatherback" : 518, "salmon":198}
                   // console.log(key + " " + value)  
                    j.push(key); //Burger Names
                    y = value; //Getting the Nested JSON Object into a variable 
                    
                    $.each(y, function(key, value) 
                    {
                        console.log(j[0])
                        console.log(j[1])
                        if(j[0] != undefined && j[1] == undefined){
                        x.push(key); //Species Name
                        z.push(value); // Number bought per Species 
                        console.log(key + " dsa " + value + " DASDSADSAD ")
                        }
                        if(j[1] != undefined && j[2] == undefined){
                            k.push(key)
                            h.push(value)  
                        }
                        if(j[2] != undefined && j[1] != undefined && j[0] != undefined){
                            s.push(key)
                            t.push(value)
                        }
                    })
                  
                    console.log(s + " hutdug")
    
                })
                
                //console.log(data.burger_by_species)
            });
            return {burger_sales_name,burger_sales_numbers,species_sales_name,species_sales_numbers,x,everything_burger_names,everything_species_names,everything_species_numbers, x, z, j , k , h , s , t};
        }
        
        async function form(){ // new solution, let's see
                var objDatetime = [];
                var objBurger = [];
                var objSpecies= [];
                var myObj = {};
                var thirdChart = [];
                var y;
                var x = [];
                var z;
                $.getJSON("/krustykrab_array.json", function(data){
               
                $.each(data.sales, function(key, value) /* Traverses Burger_by_species or Object 
                                                                    {"Krusty Combo" : Object {"leatherback" : 518, "salmon":198}", "Krabby Pattie" */
                {
                    //console.log("Hi");
                    //console.log(key); // TITLE
                    //console.log(value); // should be Object {"leatherback" : 518, "salmon":198}
                   // console.log(key + " " + value)  
                    y = value; //Getting the Nested JSON Object into a variable
                    $.each(y, function(key, value) 
                    {
                        x = value; //Getting the Nested JSON Object into a variable
                        if(key === "datetime")
                            objDatetime.push(value);
                        else if(key === "burger")
                            objBurger.push(value)
                        else if(key === "species")
                            objSpecies.push(value)
                    })
    
                })
                //console.log(data.burger_by_species)
               // console.log(objBurger)
                //console.log(objSpecies)
                for(i=0; i< objBurger.length; i++){
                     myObj = {"datetime": objDatetime[i], "burger": objBurger[i], "species":objSpecies[i]}
                //console.log(myObj)
                }
                var burger_count = 0;
                for(j=0; j< objBurger.length; j++){
                        if(myObj.burger === "Krusty Combo")
                            thirdChart.push(myObj.species)
                        else if(myObj.burger === "Krabby Pattie")
                            thirdChart.push(myObj.species)
                        else
                            thirdChart.push(myObj.species)
                    i++;
                    }
                console.log(thirdChart[0])
            });
            return {objDatetime, objBurger, objSpecies};
        }
        
        chartIt();
        chartIt2(); 
        chartIt3();
        
        async function chartIt(){ //1st chart
            const data = await readyy();  
                //console.log(data.burger_sales_name) 
            const ctx = document.getElementById('chart').getContext('2d');
            const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.burger_sales_name,
                datasets: [
                    {
                    label: data.burger_sales_name,
                    fill: false,
                    data: data.burger_sales_numbers,
                    backgroundColor: ['rgba(0,255,0,1)',  'rgba(255,255,0,1)',  'rgba(0,0,255,1)']
                    },
                ]
            },
            options: {
                legend: {
                    display: false
                    },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem) {
                        return tooltipItem.yLabel;
                                            }
                    }
                }       
            }       
        });
    }
        
        async function chartIt2(){ // 2nd chart
            const data = await readyy();  
            
            const ctx = document.getElementById('chart2').getContext('2d');
            const myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.species_sales_name,
                datasets: [
                    {
                    label: data.species_sales_name,
                    fill: false,
                    data: data.species_sales_numbers,
                    backgroundColor: ['rgba(0,255,0,1)',  'rgba(255,255,0,1)',  'rgba(0,0,255,1)'] // CHANGE COLOR OF BARS HERE
                    },
                ]
            },
        options: {
        legend: {
            display: false
        },
        tooltips: {
            callbacks: {
               label: function(tooltipItem) {
                      return tooltipItem.yLabel;
               }
            }
        }
        }   
            });
        }
    
    
        async function chartIt3(){
            const data = await readyy();  
            const ctx = document.getElementById('chart3').getContext('2d');
            console.log(" mine :" + data.z + " " + data.x)
            const myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.x,
                datasets: [
                    {
                    label: data.j,
                    fill: false,
                    data: data.z,
                    backgroundColor: ['rgba(0,255,0,1)',  'rgba(255,255,0,1)',  'rgba(0,0,255,1)'] // CHANGE COLOR OF BARS HERE
                    },
                    {
                    label: data.k,
                    fill: false,
                    data: data.h,
                    backgroundColor: ['rgba(0,255,0,1)',  'rgba(255,255,0,1)',  'rgba(0,0,255,1)'] // CHANGE COLOR OF BARS HERE
                    },
                    {
                    label: data.s,
                    fill: false,
                    data: data.t,
                    backgroundColor: ['rgba(0,255,0,1)',  'rgba(255,255,0,1)',  'rgba(0,0,255,1)'] // CHANGE COLOR OF BARS HERE
                    },
                ]
            },
            options: {
                legend: {
                    display: false
                    },
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem) {
                        return tooltipItem.yLabel;
                                            }
                    }
                }       
            }       
       
            });
        
        }
        }
    });
    
    </script>
    </div>
</body>
</html>